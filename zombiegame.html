<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zombie Survivor</title>
    <link rel="stylesheet" href="zstyle.css">
</head>
<body>
 <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="gameUI">
            <div>Health: <span id="health">100</span></div>
            <div>Score: <span id="score">0</span></div>
            <div>Stage: <span id="wave">1</span></div>
            <div>Player Level: <span id="level">1</span></div>
            <div>XP: <span id="xp">0/100</span></div>
            <div>Money: $<span id="currency">0</span></div>
            <div>Weapon: <span id="currentWeaponName">Pistol</span></div>
            <div>Zombies: <span id="zombieCount">0</span></div>
            <div>Tools: <span id="playerTools">X N:0 W:0</span></div>
            <div id="difficultyDisplay" style="color: #ffaa00; font-size: 8px; font-weight: bold;">NORMAL MODE</div>
            <div style="color: #888; font-size: 8px; margin-top: 4px;">WASD: Move | T: Auto | B: Store | R: Walls</div>
            <div style="color: #00ff00; font-size: 8px;">Auto: <span id="autoTargetStatus">ON</span></div>
        </div>
        <button id="pauseButton" onclick="togglePause()">⏸</button>
        <button id="companionButton" onclick="buyCompanion()">+ Add Ally ($100)</button>
        <button id="fullscreenButton" onclick="toggleFullscreen()">⛶</button>
        
        <!-- Game Action Controls -->
        <div id="gameActionControls" style="display: none;">
            <div id="actionButtons">
                <button class="action-btn" id="autoTargetBtn" title="Toggle Auto-Target (T)">🎯 AUTO</button>
                <button class="action-btn" id="storeBtn" title="Open/Close Store (B)">🏪 STORE</button>
                <button class="action-btn" id="wallsBtn" title="Rebuild Walls (R)">🧱 WALLS</button>
            </div>
        </div>
        
        <div id="startMenu">
            <div class="start-menu-content">
                <h1 class="game-title">ZOMBIE SURVIVOR</h1>
                <div class="subtitle">🧟 Defend the Sanctuary 🧟</div>
                
                <div class="difficulty-selection">
                    <h3>🎚️ SELECT DIFFICULTY</h3>
                    <div class="difficulty-buttons">
                        <button onclick="startNewGame('easy')" class="difficulty-button easy-mode" id="easyButton">
                            😊 EASY MODE
                            <div class="difficulty-desc">Relaxed gameplay, forgiving stats</div>
                        </button>
                        <button onclick="startNewGame('normal')" class="difficulty-button normal-mode" id="normalButton">
                            🎯 NORMAL MODE
                            <div class="difficulty-desc">Balanced challenge for most players</div>
                        </button>
                        <button onclick="startNewGame('hardcore')" class="difficulty-button hardcore-mode" id="hardcoreButton">
                            💀 HARDCORE MODE
                            <div class="difficulty-desc">Brutal survival challenge</div>
                        </button>
                    </div>
                </div>
                
                <div class="menu-options">
                    <button onclick="showHighScores()" class="menu-button" id="highScoresButton">🏆 HIGH SCORES</button>
                    <button onclick="showInstructions()" class="menu-button" id="instructionsButton">📖 HOW TO PLAY</button>
                </div>
                
                <div class="game-description">
                    <p>Survive endless waves of zombies while defending your sanctuary. Use weapons, build walls, and hire allies to stay alive as long as possible!</p>
                </div>
                
                <div class="version-info">v1.0 - Hardcore Edition</div>
            </div>
        </div>
        
        <div id="pauseOverlay">
            <div class="pause-title">PAUSED</div>
            <div class="how-to-play">
                <h3>🎮 HOW TO PLAY</h3>
                
                <div class="controls-section">
                    <h4>⌨️ Controls</h4>
                    <div class="control-grid">
                        <div><strong>WASD / Swipe</strong> - Move Player</div>
                        <div><strong>Mouse</strong> - Aim & Auto-fire</div>
                        <div><strong>T / AUTO Button</strong> - Toggle Auto-targeting</div>
                        <div><strong>B / STORE Button</strong> - Open/Close Store</div>
                        <div><strong>R / WALLS Button</strong> - Rebuild Walls (need tools)</div>
                        <div><strong>P / ESC</strong> - Pause Game</div>
                        <div><strong>F11</strong> - Toggle Fullscreen</div>
                        <div><strong>F</strong> - Skip Level 7 (if stuck)</div>
                        <div><strong>Mouse Wheel</strong> - Scroll in Store</div>
                    </div>
                </div>

                <div class="gameplay-section">
                    <h4>🎯 Objective</h4>
                    <p>Survive waves of zombies while defending the sanctuary. Kill zombies to gain XP, level up, and earn money to buy better weapons and supplies.</p>
                </div>

                <div class="systems-section">
                    <h4>🛠️ Game Systems</h4>
                    <div class="system-grid">
                        <div><strong>🏪 Store:</strong> Buy weapons, tools, and supplies</div>
                        <div><strong>🧱 Walls:</strong> Protect sanctuary from zombies</div>
                        <div><strong>👥 Allies:</strong> Hire companions to help fight</div>
                        <div><strong>🔧 Tools:</strong> Hammer, nails, wood to repair walls</div>
                        <div><strong>⚡ Safe Zone:</strong> Heal inside the sanctuary</div>
                        <div><strong>🎯 Auto-Target:</strong> Automatically aims at nearest zombie</div>
                    </div>
                </div>

                <div class="tips-section">
                    <h4>💡 Tips</h4>
                    <ul>
                        <li>Stay in the sanctuary to heal</li>
                        <li>Buy tools early to repair walls</li>
                        <li>Higher level weapons unlock as you progress</li>
                        <li>Allies help but cost money to maintain</li>
                        <li>Use mouse wheel to scroll through all weapons in store</li>
                        <li>Some weapons have special abilities (pierce, explosive, etc.)</li>
                    </ul>
                </div>
                
                <div class="pause-buttons">
                    <button onclick="togglePause()">Resume Game</button>
                    <button onclick="quitGame()" class="quit-button">Quit to Menu</button>
                    <button onclick="shareToFacebook()" class="share-button">📘 Share on Facebook</button>
                    <a href="index.html" class="home-button">← Back to Website</a>
                </div>
            </div>
        </div>
        <div id="gameOver">
            <h2 id="gameOverMessage">Game Over!</h2>
            <p>Final Score: <span id="finalScore">0</span></p>
            <p>Waves Survived: <span id="finalWave">0</span></p>
            <div id="newHighScore" style="display: none;">
                <h3>🎉 NEW HIGH SCORE! 🎉</h3>
                <input type="text" id="playerName" placeholder="Enter your name" maxlength="20">
                <button onclick="saveHighScore()">Save Score</button>
            </div>
            <button onclick="restartGame()">Play Again</button>
            <button onclick="showHighScores()">View High Scores</button>
            <button onclick="shareToFacebook()" class="share-button">📘 Share on Facebook</button>
            <button onclick="returnToMenu()" class="menu-button">Return to Menu</button>
        </div>

        <div id="highScoresModal" style="display: none;">
            <div class="modal-content">
                <h2>🏆 HIGH SCORES 🏆</h2>
                <div id="highScoresList"></div>
                <button onclick="closeHighScores()">Close</button>
                <button onclick="clearHighScores()">Clear All Scores</button>
                <button onclick="returnToMenu()" class="menu-button">Return to Menu</button>
            </div>
        </div>
    </div>

    <script src="zscript.js"></script>
    <script>


        // Mobile detection
        function isMobile() {
            return window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Facebook share function
        function shareToFacebook() {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent('🧟 I\'m surviving the zombie apocalypse in Zombie Survivor!');
            const description = encodeURIComponent('Check out this awesome zombie survival game - see how long you can last against endless waves of zombies!');
            
            // Get current game stats if available
            let shareText = title;
            if (typeof playerLevel !== 'undefined' && typeof currentWave !== 'undefined' && typeof playerScore !== 'undefined') {
                shareText = encodeURIComponent(`🧟 I reached Level ${playerLevel}, Wave ${currentWave} with ${playerScore} points in Zombie Survivor! Can you beat my score?`);
            }
            
            const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${shareText}`;
            
            // Open in new window
            window.open(facebookUrl, 'facebook-share-dialog', 'width=626,height=436,resizable=yes,scrollbars=yes');
        }

        // Add proper mobile touch support for difficulty buttons
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for game script to load
            setTimeout(function() {
                const buttons = [
                    { id: 'easyButton', difficulty: 'easy' },
                    { id: 'normalButton', difficulty: 'normal' },
                    { id: 'hardcoreButton', difficulty: 'hardcore' }
                ];
                
                buttons.forEach(function(btnInfo) {
                    const btn = document.getElementById(btnInfo.id);
                    if (btn) {
                        // Add touch event for mobile
                        btn.addEventListener('touchend', function(e) {
                            e.preventDefault();
                            if (typeof window.startNewGame === 'function') {
                                window.startNewGame(btnInfo.difficulty);
                            }
                        });
                        
                        // Also ensure click works
                        btn.addEventListener('click', function(e) {
                            e.preventDefault();
                            if (typeof window.startNewGame === 'function') {
                                window.startNewGame(btnInfo.difficulty);
                            }
                        });
                    }
                });
            }, 2000);
            
            // Game action controls management for all devices
            const gameActionControls = document.getElementById('gameActionControls');
            if (gameActionControls) {
                // Show action controls when game is running
                function updateActionControls() {
                    const startMenu = document.getElementById('startMenu');
                    if (startMenu && startMenu.style.display === 'none') {
                        gameActionControls.style.display = 'block';
                    } else {
                        gameActionControls.style.display = 'none';
                    }
                }
                
                setInterval(updateActionControls, 200);
                
                // Setup Action Button handlers
                function addActionButton(buttonId, action) {
                    const button = document.getElementById(buttonId);
                    if (button) {
                        // Add both click and touch events
                        button.addEventListener('click', function(e) {
                            e.preventDefault();
                            action();
                        });
                        button.addEventListener('touchstart', function(e) {
                            e.preventDefault();
                            action();
                        });
                    }
                }
                
                // Add action button events
                addActionButton('autoTargetBtn', function() {
                    // Simulate T key for auto-target
                    simulateKeyPress('KeyT', 84);
                });
                
                addActionButton('storeBtn', function() {
                    // Simulate B key for store
                    simulateKeyPress('KeyB', 66);
                });
                
                addActionButton('wallsBtn', function() {
                    // Simulate R key for walls
                    simulateKeyPress('KeyR', 82);
                });
            }
            
            // Mobile swipe controls (only for mobile devices)
            if (isMobile()) {
                // Setup Swipe Movement
                    
                    // Setup Swipe Movement
                    let swipeData = {
                        startX: 0,
                        startY: 0,
                        isMoving: false,
                        minSwipeDistance: 30
                    };
                    
                    // Add swipe listeners to the canvas (game area)
                    const canvas = document.getElementById('gameCanvas');
                    if (canvas) {
                        canvas.addEventListener('touchstart', function(e) {
                            // Don't interfere with mobile button touches
                            if (e.target.closest('#mobileActionButtons')) return;
                            
                            const touch = e.touches[0];
                            console.log('Touch start detected at:', touch.clientX, touch.clientY);
                            
                            // Handle store purchases before swipe handling
                            if (typeof window.showStore !== 'undefined' && window.showStore) {
                                console.log('Store is open, attempting purchase');
                                
                                // Try direct function call for store purchase
                                if (typeof window.handleStorePurchase === 'function') {
                                    console.log('Calling handleStorePurchase function');
                                    const purchaseHandled = window.handleStorePurchase(touch.clientX, touch.clientY);
                                    if (purchaseHandled) {
                                        console.log('Purchase handled successfully');
                                        e.preventDefault();
                                        e.stopPropagation();
                                        return;
                                    } else {
                                        console.log('Purchase not handled (maybe outside store area)');
                                    }
                                } else {
                                    console.log('handleStorePurchase function not available');
                                }
                            } else {
                                console.log('Store not open or showStore variable not available');
                            }
                            
                            swipeData.startX = touch.clientX;
                            swipeData.startY = touch.clientY;
                            swipeData.isMoving = false;
                        });
                        
                        canvas.addEventListener('touchmove', function(e) {
                            // Don't interfere with mobile button touches
                            if (e.target.closest('#mobileActionButtons')) return;
                            
                            e.preventDefault();
                            const touch = e.touches[0];
                            const deltaX = touch.clientX - swipeData.startX;
                            const deltaY = touch.clientY - swipeData.startY;
                            
                            // Get canvas dimensions and check if shop is open
                            const rect = canvas.getBoundingClientRect();
                            const touchX = touch.clientX - rect.left;
                            const touchY = touch.clientY - rect.top;
                            
                            // Check if touch is in shop area (when shop is open)
                            if (typeof window.showStore !== 'undefined' && window.showStore) {
                                // Shop dimensions (matching zscript.js side window)
                                const storeWidth = Math.min(400, canvas.width * 0.4);
                                const storeX = canvas.width - storeWidth - 20;
                                const storeY = 20;
                                const storeHeight = canvas.height - 40;
                                
                                if (touchX >= storeX && touchX <= storeX + storeWidth &&
                                    touchY >= storeY + 70 && touchY <= storeY + storeHeight - 30) {
                                    // Touch is in shop scrollable area - handle scrolling instead of movement
                                    if (typeof window.storeScrollY !== 'undefined') {
                                        window.storeScrollY -= deltaY * 2; // Scroll with touch movement
                                        const maxScroll = Math.max(0, 2000); // Estimate max content height
                                        window.storeScrollY = Math.max(0, Math.min(window.storeScrollY, maxScroll));
                                    }
                                    swipeData.startY = touch.clientY; // Update for smooth scrolling
                                    return; // Don't handle as player movement
                                }
                            }
                            
                            // Check if we've moved far enough to start movement
                            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                            if (distance > swipeData.minSwipeDistance) {
                                swipeData.isMoving = true;
                                
                                // Determine primary direction and simulate key press
                                const absX = Math.abs(deltaX);
                                const absY = Math.abs(deltaY);
                                
                                if (absX > absY) {
                                    // Horizontal movement
                                    if (deltaX > 0) {
                                        // Swipe right = move right
                                        simulateKeys({ w: false, s: false, a: false, d: true });
                                    } else {
                                        // Swipe left = move left
                                        simulateKeys({ w: false, s: false, a: true, d: false });
                                    }
                                } else {
                                    // Vertical movement
                                    if (deltaY > 0) {
                                        // Swipe down = move down
                                        simulateKeys({ w: false, s: true, a: false, d: false });
                                    } else {
                                        // Swipe up = move up
                                        simulateKeys({ w: true, s: false, a: false, d: false });
                                    }
                                }
                            }
                        });
                        
                        canvas.addEventListener('touchend', function(e) {
                            // Don't interfere with mobile button touches
                            if (e.target.closest('#mobileActionButtons')) return;
                            
                            // Stop all movement when touch ends
                            simulateKeys({ w: false, s: false, a: false, d: false });
                            swipeData.isMoving = false;
                        });
                    }
            }
            
            // Key simulation functions
            let currentKeys = { w: false, s: false, a: false, d: false };
            
            function simulateKeys(keys) {
                for (let key in keys) {
                    if (keys[key] !== currentKeys[key]) {
                        currentKeys[key] = keys[key];
                        const eventType = keys[key] ? 'keydown' : 'keyup';
                        const keyCode = { w: 87, s: 83, a: 65, d: 68 }[key];
                        
                        const event = new KeyboardEvent(eventType, {
                            key: key.toUpperCase(),
                            code: `Key${key.toUpperCase()}`,
                            keyCode: keyCode,
                            which: keyCode,
                            bubbles: true
                        });
                        document.dispatchEvent(event);
                    }
                }
            }
            
            function simulateKeyPress(code, keyCode) {
                const key = code.replace('Key', '').toLowerCase();
                
                // Key down
                const downEvent = new KeyboardEvent('keydown', {
                    key: key.toUpperCase(),
                    code: code,
                    keyCode: keyCode,
                    which: keyCode,
                    bubbles: true
                });
                document.dispatchEvent(downEvent);
                
                // Key up after short delay
                setTimeout(() => {
                    const upEvent = new KeyboardEvent('keyup', {
                        key: key.toUpperCase(),
                        code: code,
                        keyCode: keyCode,
                        which: keyCode,
                        bubbles: true
                    });
                    document.dispatchEvent(upEvent);
                }, 100);
            }
        });

            
        
    </script>
</body>
</html>





















